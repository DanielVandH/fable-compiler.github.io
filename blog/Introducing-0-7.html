<html><head><title>Fable Blog</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="twitter:title" content="Fable"/><meta name="twitter:description" content="F# to JS compiler"/><meta name="twitter:image" content="https://fable.io/img/fable_logo.png"/><meta name="twitter:card" content="summary_large_image"/><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Josefin+Sans:400,300,600,700|Roboto+Mono|Fira+Code|Open+Sans:400,300,600,700"/><script src="https://kit.fontawesome.com/f1c8a90b9d.js"></script><link rel="stylesheet" type="text/css" href="/css/styles.css"/><link rel="stylesheet" type="text/css" href="/css/prism.css"/><link rel="shortcut icon" href="/img/fable.ico"/></head><body><nav class="navbar"><div class="navbar-brand"><a class="navbar-item is-size-4" href="/" style="background-color:rgba(0,0,0,0.5);color:dodgerblue;font-weight:600">Fable</a><div class="navbar-burger" data-target="navMenu"><span></span><span></span><span></span></div></div><div id="navMenu" class=" navbar-menu"><div class="navbar-start"><a class=" navbar-item" href="/docs">Docs</a><a class=" navbar-item is-active" href="/blog">Blog</a><a class=" navbar-item" href="/repl">REPL</a><a class=" navbar-item" href="/community">Community</a><a class=" navbar-item" href="/fableconf">FableConf</a></div><div class="navbar-end"><div class="field is-grouped"><a class="navbar-item" href="https://gitter.im/fable-compiler/Fable" target="_blank" style="color:white"><span class="icon"><i class=" fab fa-gitter"></i></span></a><a class="navbar-item" href="https://github.com/fable-compiler/fable" target="_blank" style="color:white"><span class="icon"><i class=" fab fa-github"></i></span></a><a class="navbar-item" href="https://twitter.com/FableCompiler" target="_blank" style="color:white"><span class="icon"><i class=" fab fa-twitter"></i></span></a><a class="navbar-item" href="https://www.youtube.com/channel/UC6m70Jyr65ogDySbK7aMmzg/videos" target="_blank" style="color:white"><span class="icon"><i class=" fab fa-youtube"></i></span></a></div></div></div></nav><div class="markdown blog" style="overflow:hidden"><div class="fable-header-minimal"><figure class="image" style="max-width:200px;margin:20px auto"><img class="fable-logo" src="/img/fable_logo.png"/></figure></div><div style="margin-top:1.6rem"><div class="columns"><div class="column"></div><div class="column is-two-thirds"><div class="post_date" style="margin:5px;margin-bottom:2em"><i class=" far fa-calendar"></i> November 22, 2016</div><div class="content" style="margin:5px"><p>So finally here it is! It took a bit longer than expected but I&#39;m very happy to announce Fable 0.7 has been released to npm. This version includes lots of improvements thanks to the feedback from the community, it&#39;s almost a full rewrite and could be considered 1.0 (in fact, 1.0 will probably be this with minor upgrades). My experience when developing 0.7 has been completely different than in 0.1 times. Then I was coding alone in the room and this time... well, I&#39;m still coding alone in my room but on the other side of the internet the many faces of the community have been tremendously helping me with PRs, clever suggestions and thorough testing.</p>
<p>Fable 0.7 has been in alpha status for several weeks and during this time it&#39;s gone through multiple iterations: for several of the new features different alternatives were implemented until picking the one that worked best for all. This means you can confidently write your apps in Fable without unexpected breaking changes (because most of them already happened in the alpha cycle). That said, there will be a short transition period until all the documentation and samples are updated so please make sure to check the list below and come to our <a href="https://gitter.im/fable-compiler/Fable">Gitter channel</a> if you&#39;ve questions.</p>
<p>Let&#39;s go with the list of things to have in mind when upgrading your app to Fable 0.7!</p>
<h2><a name="projects" class="anchor" href="#projects">Projects</a></h2><p>Fable uses F# Compiler Services (FCS) which until now relied on MSBuild 2013 being installed on the system to parse <code>.fsproj</code> files and resolve references. This has caused problems for many users so now, thanks to the work of <a href="https://github.com/dsyme">Don Syme</a> on FCS and <a href="https://github.com/cloudRoutine">Jared Hester</a> and <a href="https://github.com/Krzysztof-Cieslak">Krzysztof Cie≈õlak</a> on <a href="https://github.com/fsharp-editing/Forge">Forge</a>, Fable can parse F# projects on its own. What&#39;s more, it&#39;s now possible to pass multiple project files (either <code>.fsproj</code> or <code>.fsx</code>) into <code>--projFile</code>. This is useful when you work with a solution in VS (<a href="https://github.com/fable-compiler/Fable/blob/286523fc80246a6b593df1771ef40ec9a48aca80/src/tests/fableconfig.json">example</a>).</p>
<blockquote>
<p><strong>Caveats</strong>: Like source files, project files must be in <strong>compilation order</strong>. Also, Forge is not as powerful as MSBuild (e.g. conditional items won&#39;t work), so please keep your <code>.fsproj</code> simple.</p>
</blockquote>
<h2><a name="references" class="anchor" href="#references">References</a></h2><p>One of biggest Fable drawbacks so far has been the difficulty to creat Fable libraries: sometimes it was necessary to distribute source files, other you could create a <code>.dll</code> but compiling and referencing it was rather convoluted. This has prevented the growth of Fable ecosystem, so it was a priority fix for 0.7.</p>
<p>Now there&#39;s a <code>--dll</code> compiler flag that, when activated, will make Fable generate a <code>.dll</code> assembly for your project together with a <code>.fablemap</code> file containing the mapping of the F# types in the assembly to the compiled JS files. Customer projects will only have to reference this <code>.dll</code> and Fable will automatically recognize the <code>.fablemap</code> file and generate the appropriate JS imports. <a href="https://github.com/fable-compiler/fable-powerpack">Fable.PowerPack</a> is an example of such a library.</p>
<blockquote>
<p><strong>Caveats</strong>: Remember to distribute the <code>.dll</code> assembly together with the <code>.fablemap</code> file and the generated JS files (keeping the same structure as in <code>outDir</code>). There&#39;s already work going on to link npm packages directly from <code>.fsproj</code> so please keep the convention of using the assembly name for your npm package with snake case (e.g. <code>Fable.Elmish</code> becomes <code>fable-elmish</code>). Also, see below how to include several distros in your package.</p>
</blockquote>
<h2><a name="generic-resolution" class="anchor" href="#generic-resolution">Generic Resolution</a></h2><p>In order to output standard and performant JS code, Fable is not including generic information in the runtime. However this information is still necessary in some cases to properly resolve calls. The way to solve this conundrum so far was to inline code, but this is not always desirable and Fable can neither inline if it has no access to the source code.</p>
<p>Several ways to fix the issue were tested until <code>PassGenericsAttribute</code> was added to <code>Fable.Core</code>. Now, if you need generic type info at runtime, just decorate a function with this attribute and Fable and you will be able to do <code>typeof&lt;&#39;T&gt;</code> within its body (<a href="https://github.com/fable-compiler/Fable/blob/286523fc80246a6b593df1771ef40ec9a48aca80/src/tests/Main/ReflectionTests.fs#L42-L52">example</a>). This way you can still write advanced generic code in Fable without having to pollute your whole code base or affecting compatibility with external JS code. The best of the two worlds!</p>
<blockquote>
<p><strong>Caveat</strong>: Functions decorated with <code>PassGenericsAttribute</code> may work unexpectedly if called from external JS code.</p>
</blockquote>
<h2><a name="es2015-modules-and-bundling" class="anchor" href="#es2015-modules-and-bundling">ES2015 Modules and Bundling</a></h2><p>Bundling is often the only sane way to manage dependencies for browser JS apps and so far this has been accomplished by <a href="https://webpack.github.io/">Webpack</a> but, as flexible and comprehensive as this tool is, it still has two problems: 1) it can be somewhat complex to configure and 2) doesn&#39;t understand (yet) <a href="http://www.2ality.com/2014/09/es6-modules-final.html">ES2015 modules</a>.</p>
<p>The biggest advantage of ES2015 modules is they allow static analysis of the dependencies among files which makes it much easier for a bundler to discard unused code. Fable compiles F# code using ES2015 imports and exports (provided you&#39;ve a single root module per file) which makes it a perfect fit for such a bundler. Furthermore, now <a href="https://www.npmjs.com/package/fable-core">fable-core</a> too is completely modular so your apps will only pay for what they get: not only the bundle will skip unused modules (say <code>Async</code> if you only use native JS <code>Promise</code>) but also any function from imported modules that you don&#39;t actually need.</p>
<p>Thanks to <a href="https://github.com/Pauan">Pauan</a> (who&#39;s also been tremendously helping 0.7 development with many wonderful suggestions) and Rollup friends, Fable 0.7 comes with <a href="http://rollupjs.org/">Rollup</a> embedded, a lightweight bundler that can understand ES2015 modules. Now bundling your app is as simple as passing the <code>--rollup</code> flag to the compiler. In <code>fableconfig</code> it&#39;s also possible to pass a configuration object instead corresponding to <a href="https://github.com/rollup/rollup/wiki/JavaScript-API">Rollup JS API</a> options. The only difference is plugins, which must be passed differently as fableconfig cannot contain code. The same format as with Babel plugins is used (See &quot;Plugin/Presets Options&quot; <a href="https://babeljs.io/docs/plugins/">here</a>). These settings are equivalent:</p>
<pre><code class="language-js"><span class="token function">rollup</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">commonjs</span><span class="token punctuation">(</span><span class="token punctuation">{</span> namedExports<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">"virtual-dom"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"h"</span><span class="token punctuation">,</span> <span class="token string">"create"</span><span class="token punctuation">,</span> <span class="token string">"diff"</span><span class="token punctuation">,</span> <span class="token string">"patch"</span> <span class="token punctuation">]</span>
      <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<pre><code class="language-json"><span class="token property">"rollup"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">"commonjs"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token property">"namedExports"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"virtual-dom"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">"h"</span><span class="token punctuation">,</span> <span class="token string">"create"</span><span class="token punctuation">,</span> <span class="token string">"diff"</span><span class="token punctuation">,</span> <span class="token string">"patch"</span> <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The default Rollup configuration in Fable is as follows (any option in fableconfig will override them, including plugins):</p>
<pre><code class="language-js"><span class="token punctuation">{</span>
    <span class="token comment">// entry: &lt;Last F# source file></span>
    dest<span class="token operator">:</span> fableOptions<span class="token punctuation">.</span>outDir <span class="token operator">+</span> <span class="token string">"/bundle.js"</span><span class="token punctuation">,</span>
    format<span class="token operator">:</span> fableOptions<span class="token punctuation">.</span>module <span class="token operator">||</span> <span class="token string">"iife"</span><span class="token punctuation">,</span>
    sourceMap<span class="token operator">:</span> fableOptions<span class="token punctuation">.</span>sourceMaps<span class="token punctuation">,</span>
    moduleName<span class="token operator">:</span> <span class="token function">normalizeProjectName</span><span class="token punctuation">(</span>fableOptions<span class="token punctuation">)</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'rollup-plugin-node-resolve'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span> ignoreGlobal<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'rollup-plugin-commonjs'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span> jsnext<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> main<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> browser<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>If you&#39;re writing a Node app or using <a href="http://requirejs.org/">RequireJS</a> and <strong>don&#39;t want to bundle</strong>, just use the UMD distribution of <code>fable-core</code>. The <code>--refs</code> compiler argument gives you a chance to replace the base directory of imported JS files when referencing assemblies (<a href="https://github.com/fable-compiler/Fable/blob/85fb471ecc77b6d7296c5a1513e89e95f44c225b/samples/browser/react-todomvc/fableconfig.json">example</a>):</p>
<pre><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"refs"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"Fable.Core"</span><span class="token operator">:</span> <span class="token string">"fable-core/umd"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Because of this, it&#39;s recommended that Fable libraries include two distributions: the default one with ES2015 modules, and another one in the <code>umd</code> subdirectory with UMD modules. Just create an <code>umd</code> target for your library and compile it as well before publishing (<a href="https://github.com/fable-compiler/fable-powerpack/blob/master/fableconfig.json">example</a>).</p>
<blockquote>
<p><strong>Caveat</strong>: Though Rollup can understand <code>commonjs</code> modules, it&#39;s not as powerful as Webpack and can have problems bundling some packages (notably <a href="https://facebook.github.io/react/">React</a>). In this case you may want to load the JS library globally with a <code>&lt;script&gt;</code> tag (<a href="https://github.com/fable-compiler/fable-elmish/blob/e34232b8fbbf979fd800d9c24a386c2a2ffda966/samples/react/counter/fableconfig.json">example</a>) or with RequireJS (<a href="https://github.com/fable-compiler/Fable/blob/85fb471ecc77b6d7296c5a1513e89e95f44c225b/samples/browser/react-todomvc/index.html#L25-L33">example</a>). Of course, it&#39;s still possible to skip Rollup bundling and use Webpack as before.</p>
</blockquote>
<h2><a name="json-serialization" class="anchor" href="#json-serialization">JSON Serialization</a></h2><p>It was actually <a href="https://github.com/davidtme">David Teasdale</a> who started work on 0.7 with a PR to remove the need of the <code>$type</code> file when serializing and deserializing. This has led to the development of a reflection system for Fable, which can provide type information at runtime to <em>inflate</em> JSON strings into proper instances of your F# types with all the semantics: structural equality (if applicable), access to instance and static members as well as the inheritance chain, etc. Also, thanks to <a href="https://github.com/7sharp9">Dave Thomas</a>&#39; suggestion, Fable compresses serialized union types like <a href="https://github.com/Microsoft/fsharplu/wiki/fsharplu.json">FSharpLu</a> resulting in much smaller JSON payloads. To interact with <a href="http://www.newtonsoft.com/json">Json.NET</a> on the server side, just use the Fable.JsonConverter available as a <a href="https://www.nuget.org/packages/Fable.JsonConverter">Nuget package</a>.</p>
<blockquote>
<p>Reflection info is only produced on demand so your types won&#39;t have any overhead compared to normal JS objects.</p>
</blockquote>
<p>If you still want to use the old method (e.g. when you don&#39;t know the concrete type you will receive), please call the <code>toJsonWithTypeInfo</code> and <code>ofJsonWithTypeInfo</code> functions. You can then interact with Json.NET using the <code>TypeNameHandling.All</code> option, but please remember Json.NET is not adding type info to F# union types so you will need <a href="https://github.com/fable-compiler/Fable/blob/master/src/tools/UnionTypeInfoConverter.fsx">the following converter</a>.</p>
<br />

<p>There are still many new features in Fable 0.7, here I&#39;m only listing the most important points for the migration. Again, please be understanding while the documentation and samples are being updated. The community is already making wonderful with Fable like the <a href="http://rio2016.thegamma.net/">Gamma Project</a> by Tomas Petricek, <a href="http://ionide.io/">Ionide</a> by Krzysztof Cie≈õlak, <a href="https://github.com/fable-compiler/fable-elmish">fable-elmish</a> by Eugene Tolmachev and <a href="http://fable.io/fable-arch/">fable-arch</a> by Tomas Jansson and Maxime Mangel, as well as Steffen Forkmann and Fran√ßois Nicaise work on React Native and Pixi.js respectively; and I&#39;m sure there will be many other great projects coming with Fable 0.7. There&#39;s already work going on to improve editor support and Enrico Sada is bringing a surprise for the new <code>.fsproj</code> format, so there are exciting times ahead for Fable. Keep tuned!</p>
</div></div><div class="column"></div></div></div></div><footer style="background-color:dodgerblue"><div class="content"><p>Fable <a href="https://github.com/fable-compiler/Fable">source code</a> is licensed <a href="http://opensource.org/licenses/mit-license.php">MIT</a>.</p></div></footer><script>
document.addEventListener('DOMContentLoaded', function () {
  // burger
  var $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);
  if ($navbarBurgers.length > 0) {
    $navbarBurgers.forEach(function ($el) {
      $el.addEventListener('click', function () {
        var target = $el.dataset.target;
        var $target = document.getElementById(target);
        $el.classList.toggle('is-active');
        $target.classList.toggle('is-active');
      });
    });
  }
});</script></body></html>