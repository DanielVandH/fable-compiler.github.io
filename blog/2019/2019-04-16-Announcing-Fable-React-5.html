<html class="has-navbar-fixed-top"><head><title>Fable</title><meta http-equiv="content-type"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" type="text/css" href="/style.css"/><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous"/></head><body><nav class="navbar is-fixed-top"><div class="container"><div class="navbar-brand"><a class="navbar-item title is-4" href="https://fable.io/">Fable</a><a class="navbar-item is-hidden-desktop" href="https://github.com/fable-compiler/fable"><span class="icon"><i class=" fab fa-github fa-lg"></i></span></a><a class="navbar-item is-hidden-desktop" href="https://twitter.com/FableCompiler"><span class="icon"><i class=" fab fa-twitter fa-lg"></i></span></a><a class="navbar-item is-hidden-desktop" href="https://gitter.im/fable-compiler/Fable"><span class="icon"><i class=" fab fa-gitter fa-lg"></i></span></a><a class="navbar-item is-hidden-desktop" href="https://www.youtube.com/channel/UC6m70Jyr65ogDySbK7aMmzg/videos"><span class="icon"><i class=" fab fa-youtube fa-lg"></i></span></a><a class="navbar-burger" data-target="nav-menu"><span></span><span></span><span></span></a></div><div class="navbar-menu" id="nav-menu"><div class="navbar-start"><a class="navbar-item" href="/docs">Documentation</a><a class="navbar-item" href="/repl/">Try</a><a class="navbar-item is-active" href="/blog/index.html">Blog</a><a class="navbar-item" href="/community.html">Community</a><a class="navbar-item" href="/resources.html">Resources</a></div><div class="navbar-end"><a class="navbar-item" href="https://github.com/fable-compiler/fable"><span class="icon"><i class=" fab fa-github fa-lg"></i></span></a><a class="navbar-item" href="https://twitter.com/FableCompiler"><span class="icon"><i class=" fab fa-twitter fa-lg"></i></span></a><a class="navbar-item" href="https://gitter.im/fable-compiler/Fable"><span class="icon"><i class=" fab fa-gitter fa-lg"></i></span></a><a class="navbar-item" href="https://www.youtube.com/channel/UC6m70Jyr65ogDySbK7aMmzg/videos"><span class="icon"><i class=" fab fa-youtube fa-lg"></i></span></a></div></div></div></nav><div class="container"><div class="columns"><div class="column is-8-desktop is-offset-2-desktop"><div class="section blog-post"><figure class="image is-96x96 author-image"><img class="is-rounded" src="https://github.com/alfonsogarciacaro.png"/></figure><h2 class="title is-size-3 has-text-primary has-text-weight-normal has-text-centered blog-title">Announcing Fable.React 5</h2><div class="tags has-addons is-justify-content-center"><a class="tag is-rounded is-medium is-primary" href="https://twitter.com/alfonsogcnunez">Alfonso García-Caro</a><span class="tag is-rounded is-medium">April 16, 2019</span></div><div class="content"><p>Fable.React 5 has just been released with new additions to help write your Fable/Elmish apps with React. Before going into detail, I want to thank Julien Roncaglia (@vbfox) who has contributed most of the ideas for this release since <a href="https://www.youtube.com/watch?v=9VJoaNoutm4">his talk at latest FableConf</a>, as well as the React team for their great work in the latest releases. And also to Don Syme and the other F# compiler contributors who have added features like anonymous records to make F# even more suitable to write UIs!</p>
<blockquote>
<p>Note this release depends on Fable.Core 3 and Fable.Browser.Dom, please <a href="https://fable.io/blog/Announcing-2-2.html">read the previous post</a> to learn about the changes in the ecosystem.</p>
</blockquote>
<p>So far, in Elmish applications the most common way to render the UI was to use simple functions, which is great and shows the power of Functional Programming for building UIs. However, in order to use React features like keeping internal state or getting a reference to the actual element in the browser's DOM, we had to declare a full class component. It worked, but required quite a bit of code to turn the view functions into classes and override the proper methods.</p>
<p>This is about to end since React 16.8 and the introduction of <a href="https://reactjs.org/docs/hooks-overview.html">hooks</a> which gives function components the same possibilities as class components have. Fable.React 5 focus on this and, in fact, from now on it may be difficult to tell functions from function components apart, so let's learn more about what distinguishes them.</p>
<h2>Functions vs Function Components <a href="#Functions-vs-Function-Components" aria-hidden="true"><span class="anchor" id="Functions-vs-Function-Components"></span>#</a></h2>
<p>Functions are <strong>just functions</strong> (I'm also in a position to confirm water is wet): each time you call them, their code is run, you get a value in return and forget about them.</p>
<pre style="background-color: #FFFFFF;color: #000000;padding: 1em"><code><span style="color: #A626A4">open</span><span> </span><span style="color: #4078F2">Fable.React</span>

<span style="color: #A626A4">let</span><span> </span><span style="color: #E45649">myView</span><span style="color: #383A42"> </span><span style="color: #A626A4">(</span><span style="color: #383A42">props</span><span style="color: #A626A4">:</span><span> </span><span style="color: #C18401">MyProps</span><span style="color: #A626A4">)</span><span> </span><span style="color: #A626A4">=</span>
<span>    div </span><span style="color: #A626A4">[]</span><span> </span><span style="color: #A626A4">[</span><span>str props.message</span><span style="color: #A626A4">]</span>

<span style="color: #A0A1A7;font-style: italic">// We could just replace the call to myView with</span>
<span style="color: #A0A1A7;font-style: italic">// the body of the function and get the same result</span>
<span style="color: #A626A4">let</span><span> </span><span style="color: #E45649">rootView</span><span style="color: #383A42"> msg </span><span style="color: #A626A4">=</span>
<span>    myView </span><span style="color: #A626A4">{</span><span> message </span><span style="color: #A626A4">=</span><span> msg </span><span style="color: #A626A4">}</span></code></pre>
<p>On the other hand, function components are <strong>actual entities</strong> in the Virtual DOM, which means you can visualize them in the React dev tools or include triggers for different moments of the component's life cycle. In Fable.React 5 we use the <code>FunctionComponent</code> helper to declare them. The signature is the same as that of a function <code>'Props -&gt; ReactElement</code> so, as a convention, we will use <strong>upper case to name them</strong> and highlight them over simple functions.</p>
<pre style="background-color: #FFFFFF;color: #000000;padding: 1em"><code><span style="color: #A626A4">let</span><span> </span><span style="color: #E45649">MyView</span><span> </span><span style="color: #A626A4">=</span>
<span>    FunctionComponent.Of</span><span style="color: #A626A4">(fun</span><span style="color: #383A42"> </span><span style="color: #A626A4">(</span><span style="color: #383A42">props</span><span style="color: #A626A4">:</span><span style="color: #C18401"> Props</span><span style="color: #A626A4">)</span><span> </span><span style="color: #A626A4">-&gt;</span>
<span>        div </span><span style="color: #A626A4">[]</span><span> </span><span style="color: #A626A4">[</span><span>str props.message</span><span style="color: #A626A4">])</span>

<span style="color: #A626A4">let</span><span> </span><span style="color: #E45649">rootView</span><span style="color: #383A42"> msg </span><span style="color: #A626A4">=</span>
<span>    MyView </span><span style="color: #A626A4">{</span><span> message </span><span style="color: #A626A4">=</span><span> msg </span><span style="color: #A626A4">}</span></code></pre>
<blockquote>
<p>This distinction is not exactly the same in React, because React apps usually use JSX for the UI code so the difference radicates in <em>the way you call the function</em>. Because Fable apps just use F#, we need the <code>FunctionComponent</code> wrapper to get the desired behavior.</p>
</blockquote>
<p>When to use a function component? Whenever you need:</p>
<ul>
<li>To <strong>skip rendering</strong> the component if the props haven't changed. This is specially important when using central state management like Elmish, because every time our UI model is updated a new render for the whole app will be triggered. Skip the parts of the UI tree that don't need to change with the <code>memoizeWith</code> parameter, which receives a function to check if the old and new props are equal. Fable.React 5 also provides the <code>equalsButFunctions</code> helper which doesn't take into account the functions in the props object (useful in Elmish apps where we usually pass the <code>dispatch</code> function down the UI tree).</li>
</ul>
<pre style="background-color: #FFFFFF;color: #000000;padding: 1em"><code><span style="color: #A626A4">let</span><span> </span><span style="color: #E45649">MyView</span><span>  </span><span style="color: #A626A4">=</span>
<span>    FunctionComponent.Of</span><span style="color: #A626A4">((fun</span><span style="color: #383A42"> p </span><span style="color: #A626A4">-&gt;</span><span> </span><span style="color: #A626A4">..),</span><span> memoizeWith </span><span style="color: #A626A4">=</span><span> equalsButFunctions</span><span style="color: #A626A4">)</span></code></pre>
<ul>
<li>
<p>To keep some <strong>internal state</strong> for the component, which can be done using React's state hook. Hooks also give you more capabilities concerning the component's life cycle. Read more about them in the next section.</p>
</li>
<li>
<p>To <strong>visualize the component</strong> in React dev tools, very helpful for debugging. Use the <code>displayName</code> parameter to set a custom name for the component in React dev tools.</p>
</li>
</ul>
<h2>React Hooks <a href="#React-Hooks" aria-hidden="true"><span class="anchor" id="React-Hooks"></span>#</a></h2>
<p>In Elmish apps we keep a central model for our whole app so most of the times we don't need stateful React components.</p>
<pre style="background-color: #FFFFFF;color: #000000;padding: 1em"><code><span style="color: #A626A4">let</span><span> </span><span style="color: #E45649">view</span><span style="color: #383A42"> </span><span style="color: #A626A4">(</span><span style="color: #383A42">props</span><span style="color: #A626A4">:</span><span style="color: #C18401"> </span><span style="color: #A626A4">{|</span><span> count</span><span style="color: #A626A4">:</span><span> int</span><span style="color: #A626A4">;</span><span> dispatch</span><span style="color: #A626A4">:</span><span> int </span><span style="color: #A626A4">-&gt;</span><span> unit </span><span style="color: #A626A4">|})</span><span> </span><span style="color: #A626A4">=</span>
<span>      button</span>
<span>        </span><span style="color: #A626A4">[</span><span> OnClick </span><span style="color: #A626A4">(fun</span><span style="color: #383A42"> _ </span><span style="color: #A626A4">-&gt;</span><span> props.count </span><span style="color: #A626A4">+</span><span> </span><span style="color: #986801">1</span><span> </span><span style="color: #A626A4">|&gt;</span><span> props.dispatch</span><span style="color: #A626A4">)</span><span> </span><span style="color: #A626A4">]</span>
<span>        </span><span style="color: #A626A4">[</span><span> str </span><span style="color: #50A14F">&quot;Times clicked: &quot;</span><span style="color: #A626A4">;</span><span> ofInt props.count </span><span style="color: #A626A4">]</span></code></pre>
<p>In some occasions however we don't want to include some very specific internal state in the global model (e.g. whether a dropdown is open or closed), and in order to do that we need to deploy a full class. The example above would become:</p>
<pre style="background-color: #FFFFFF;color: #000000;padding: 1em"><code><span style="color: #A626A4">type</span><span> </span><span style="color: #C18401">Props</span><span> </span><span style="color: #A626A4">=</span><span> </span><span style="color: #A626A4">{</span><span> initCount</span><span style="color: #A626A4">:</span><span> </span><span style="color: #C18401">int </span><span style="color: #A626A4">}</span>
<span style="color: #A626A4">type</span><span> </span><span style="color: #C18401">State</span><span> </span><span style="color: #A626A4">=</span><span> </span><span style="color: #A626A4">{</span><span> count</span><span style="color: #A626A4">:</span><span> </span><span style="color: #C18401">int </span><span style="color: #A626A4">}</span>

<span style="color: #A626A4">type</span><span> </span><span style="color: #C18401">MyView</span><span style="color: #A626A4">(</span><span style="color: #383A42">props</span><span style="color: #A626A4">)</span><span> </span><span style="color: #A626A4">=</span>
<span>    </span><span style="color: #A626A4">inherit</span><span> Component</span><span style="color: #A626A4">&lt;</span><span>Props</span><span style="color: #A626A4">,</span><span> State</span><span style="color: #A626A4">&gt;(</span><span>props</span><span style="color: #A626A4">)</span>
<span>    </span><span style="color: #A626A4">do</span><span> base.setInitState</span><span style="color: #A626A4">({</span><span> count </span><span style="color: #A626A4">=</span><span> props.initCount </span><span style="color: #A626A4">})</span>

<span>    </span><span style="color: #A626A4">override</span><span> </span><span style="color: #E45649">this.render</span><span style="color: #986801">()</span><span> </span><span style="color: #A626A4">=</span>
<span>          button</span>
<span>            </span><span style="color: #A626A4">[</span><span> OnClick </span><span style="color: #A626A4">(fun</span><span style="color: #383A42"> _ </span><span style="color: #A626A4">-&gt;</span>
<span>                this.setState</span><span style="color: #A626A4">(fun</span><span style="color: #383A42"> s _ </span><span style="color: #A626A4">-&gt;</span><span> </span><span style="color: #A626A4">{</span><span> s </span><span style="color: #A626A4">with</span><span> count </span><span style="color: #A626A4">=</span><span> s.count </span><span style="color: #A626A4">+</span><span> </span><span style="color: #986801">1</span><span> </span><span style="color: #A626A4">}))</span><span> </span><span style="color: #A626A4">]</span>
<span>            </span><span style="color: #A626A4">[</span><span> str </span><span style="color: #50A14F">&quot;Times clicked: &quot;</span><span style="color: #A626A4">;</span><span> ofInt this.state.count </span><span style="color: #A626A4">]</span></code></pre>
<p>The situation gets more complicated when we also want to trigger some code at specific points in the life cycle, keep a reference to value outside the component state, etc. Thankfully, since React 16.8 we can use hooks to empower functions with all these capabilities. Now adding state to a component is as simple as:</p>
<pre style="background-color: #FFFFFF;color: #000000;padding: 1em"><code><span style="color: #A626A4">let</span><span> </span><span style="color: #E45649">view</span><span> </span><span style="color: #A626A4">=</span>
<span>    FunctionComponent.Of</span><span style="color: #A626A4">(fun</span><span style="color: #383A42"> </span><span style="color: #A626A4">(</span><span style="color: #383A42">props</span><span style="color: #A626A4">:</span><span style="color: #C18401"> </span><span style="color: #A626A4">{|</span><span> </span><span style="color: #383A42">initCount</span><span style="color: #A626A4">:</span><span style="color: #C18401"> int </span><span style="color: #A626A4">|})</span><span> </span><span style="color: #A626A4">-&gt;</span>
<span>    </span><span style="color: #A626A4">let</span><span> </span><span style="color: #E45649">state</span><span> </span><span style="color: #A626A4">=</span><span> Hooks.useState</span><span style="color: #A626A4">(</span><span>props.initCount</span><span style="color: #A626A4">)</span><span> </span><span style="color: #A0A1A7;font-style: italic">// This is where the magic happens</span>
<span>    button</span>
<span>        </span><span style="color: #A626A4">[</span><span> OnClick </span><span style="color: #A626A4">(fun</span><span style="color: #383A42"> _ </span><span style="color: #A626A4">-&gt;</span><span> state.update</span><span style="color: #A626A4">(fun</span><span style="color: #383A42"> s </span><span style="color: #A626A4">-&gt;</span><span> s </span><span style="color: #A626A4">+</span><span> </span><span style="color: #986801">1</span><span style="color: #A626A4">))</span><span> </span><span style="color: #A626A4">]</span>
<span>        </span><span style="color: #A626A4">[</span><span> str </span><span style="color: #50A14F">&quot;Times clicked: &quot;</span><span style="color: #A626A4">;</span><span> ofInt state.current </span><span style="color: #A626A4">]</span>
<span>    </span><span style="color: #A626A4">)</span></code></pre>
<p>I won't explain hooks in detail because <a href="https://reactjs.org/docs/hooks-overview.html">React documentation is already a fantastic source</a> for that. Fable.React 5 provides bindings for the most commonly used hooks (<code>useState</code>, <code>useEffect</code>, <code>useRef</code>, <code>useMemo</code>...) matching React's API for the most part, except for a few cases where a different name is necessary to comply with F# overloading rules. I will only show another example combining <code>useEffect</code> and <code>useRef</code> to detect a click <em>outside</em> our component, something that beforehand required quite a bit of code.</p>
<pre style="background-color: #FFFFFF;color: #000000;padding: 1em"><code><span style="color: #A626A4">open</span><span> </span><span style="color: #4078F2">Browser.Types</span>

<span style="color: #A626A4">let</span><span> </span><span style="color: #E45649">attachEvent</span><span style="color: #383A42"> </span><span style="color: #A626A4">(</span><span style="color: #383A42">f</span><span style="color: #A626A4">:</span><span> </span><span style="color: #C18401">Event</span><span style="color: #A626A4">-&gt;</span><span style="color: #C18401">unit</span><span style="color: #A626A4">)</span><span> </span><span style="color: #A626A4">(</span><span style="color: #383A42">node</span><span style="color: #A626A4">:</span><span> </span><span style="color: #C18401">Node</span><span style="color: #A626A4">)</span><span> </span><span style="color: #A626A4">(</span><span style="color: #383A42">eventType</span><span style="color: #A626A4">:</span><span> </span><span style="color: #C18401">string</span><span style="color: #A626A4">)</span><span> </span><span style="color: #A626A4">=</span>
<span>    node.addEventListener</span><span style="color: #A626A4">(</span><span>eventType</span><span style="color: #A626A4">,</span><span> f</span><span style="color: #A626A4">)</span>
<span>    </span><span style="color: #A626A4">{</span><span> </span><span style="color: #A626A4">new</span><span> System.IDisposable </span><span style="color: #A626A4">with</span>
<span>        </span><span style="color: #A626A4">member</span><span> </span><span style="color: #E45649">__.Dispose</span><span style="color: #986801">()</span><span> </span><span style="color: #A626A4">=</span><span> node.removeEventListener</span><span style="color: #A626A4">(</span><span>eventType</span><span style="color: #A626A4">,</span><span> f</span><span style="color: #A626A4">)</span><span> </span><span style="color: #A626A4">}</span>

<span style="color: #A626A4">let</span><span> </span><span style="color: #E45649">view</span><span> </span><span style="color: #A626A4">=</span>
<span>    FunctionComponent.Of</span><span style="color: #A626A4">(fun</span><span style="color: #383A42"> props </span><span style="color: #A626A4">-&gt;</span>
<span>        </span><span style="color: #A0A1A7;font-style: italic">// Keep a value ref during component&#039;s life cycle, initialized to None</span>
<span>        </span><span style="color: #A626A4">let</span><span> </span><span style="color: #E45649">selfRef</span><span> </span><span style="color: #A626A4">=</span><span> Hooks.useRef None</span>

<span>        </span><span style="color: #A0A1A7;font-style: italic">// Passing an empty array for dependencies tells React the effect should</span>
<span>        </span><span style="color: #A0A1A7;font-style: italic">// only run when mounting (and the disposable when unmounting)</span>
<span>        Hooks.useEffectDisposable</span><span style="color: #A626A4">((fun</span><span style="color: #383A42"> </span><span style="color: #A626A4">()</span><span> </span><span style="color: #A626A4">-&gt;</span>
<span>            </span><span style="color: #A626A4">(</span><span>Browser.Dom.document</span><span style="color: #A626A4">,</span><span> </span><span style="color: #50A14F">&quot;mousedown&quot;</span><span style="color: #A626A4">)</span><span> </span><span style="color: #A626A4">||&gt;</span><span> attachEvent </span><span style="color: #A626A4">(fun</span><span style="color: #383A42"> ev </span><span style="color: #A626A4">-&gt;</span>
<span>                </span><span style="color: #A626A4">let</span><span> </span><span style="color: #E45649">menuEl</span><span style="color: #A626A4">:</span><span> </span><span style="color: #C18401">Element </span><span style="color: #A626A4">=</span><span> selfRef.current.Value</span>
<span>                </span><span style="color: #A626A4">if</span><span> not</span><span style="color: #A626A4">(</span><span>menuEl.contains</span><span style="color: #A626A4">(</span><span>ev.target </span><span style="color: #A626A4">:?&gt;</span><span> </span><span style="color: #A626A4">_))</span><span> </span><span style="color: #A626A4">then</span>
<span>                    printfn </span><span style="color: #50A14F">&quot;Clicked outside!&quot;</span><span style="color: #A626A4">)</span>
<span>        </span><span style="color: #A626A4">),</span><span> </span><span style="color: #A626A4">[||])</span>

<span>        button</span>
<span>            </span><span style="color: #A0A1A7;font-style: italic">// We can pass the ref object directly to the new RefHook prop</span>
<span>            </span><span style="color: #A0A1A7;font-style: italic">// to get a reference to the actual button element in the browser&#039;s doom</span>
<span>            </span><span style="color: #A626A4">[</span><span> RefHook selfRef</span>
<span>              OnClick </span><span style="color: #A626A4">(fun</span><span style="color: #383A42"> _ </span><span style="color: #A626A4">-&gt;</span><span> printfn </span><span style="color: #50A14F">&quot;Clicked inside!&quot;</span><span style="color: #A626A4">)</span><span> </span><span style="color: #A626A4">]</span>
<span>            </span><span style="color: #A626A4">[</span><span> str </span><span style="color: #50A14F">&quot;Click me&quot;</span><span> </span><span style="color: #A626A4">]</span>
<span>    </span><span style="color: #A626A4">)</span></code></pre>
<h2>Type-safe CSS props <a href="#Type-safe-CSS-props" aria-hidden="true"><span class="anchor" id="Type-safe-CSS-props"></span>#</a></h2>
<p>The following CSS props now accept a union type instead of a simple string for better type safety and discoverability. Thanks to Zaid-Ajaj for this contribution!</p>
<ul>
<li>Display</li>
<li>Position</li>
<li>TextAlign</li>
<li>AlignContent</li>
<li>AlignItems</li>
<li>AlignSelf</li>
</ul>
<pre style="background-color: #FFFFFF;color: #000000;padding: 1em"><code><span>div </span><span style="color: #A626A4">[</span><span> Display DisplayOptions.Flex </span><span style="color: #A626A4">]</span><span> </span><span style="color: #A626A4">[</span><span> </span><span style="color: #A626A4">]</span></code></pre>
<h2>Code Splitting <a href="#Code-Splitting" aria-hidden="true"><span class="anchor" id="Code-Splitting"></span>#</a></h2>
<p>Fable.React 5 also includes initial support for &quot;code splitting&quot;, that is, split your JS bundle in order to defer the download of parts that are not immediately accessible to the user (a very handy feature in Single Page Applications). So far, this has been quite tricky in Fable apps: we had to create a separate project and import it manually using a string. Fable.React 5 includes <code>FunctionComponent.Lazy</code> which can automatically defer the download of the code for a React component with minimum changes to your code.</p>
<blockquote>
<p>IMPORTANT: For this feature to work you need <code>fable-compiler</code> (npm) 2.3 or higher.</p>
</blockquote>
<pre style="background-color: #FFFFFF;color: #000000;padding: 1em"><code><span style="color: #A0A1A7;font-style: italic">// About.fs</span>
<span style="color: #A626A4">let</span><span> </span><span style="color: #E45649">view</span><span style="color: #383A42"> </span><span style="color: #A626A4">(</span><span style="color: #383A42">props</span><span style="color: #A626A4">:</span><span style="color: #C18401"> </span><span style="color: #A626A4">{|</span><span> model</span><span style="color: #A626A4">:</span><span> Model</span><span style="color: #A626A4">;</span><span> dispatch</span><span style="color: #A626A4">:</span><span> Msg</span><span style="color: #A626A4">-&gt;</span><span>unit </span><span style="color: #A626A4">|})</span><span> </span><span style="color: #A626A4">=</span><span> </span><span style="color: #A626A4">..</span>

<span style="color: #A0A1A7;font-style: italic">// Router.fs</span>
<span style="color: #A626A4">let</span><span> </span><span style="color: #E45649">AboutPage</span><span> </span><span style="color: #A626A4">=</span>
<span>    FunctionComponent.Lazy</span><span style="color: #A626A4">(</span>
<span>        About.view</span><span style="color: #A626A4">,</span><span> </span><span style="color: #A0A1A7;font-style: italic">// Pass a direct reference to the view function in the external file</span>
<span>        fallback </span><span style="color: #A626A4">=</span><span> div </span><span style="color: #A626A4">[]</span><span> </span><span style="color: #A626A4">[</span><span>str </span><span style="color: #50A14F">&quot;Loading...&quot;</span><span style="color: #A626A4">])</span>

<span style="color: #A626A4">let</span><span> </span><span style="color: #E45649">view</span><span style="color: #383A42"> page </span><span style="color: #A626A4">=</span>
<span>    </span><span style="color: #A626A4">match</span><span> page </span><span style="color: #A626A4">with</span>
<span>    </span><span style="color: #A626A4">|</span><span> Home </span><span style="color: #A626A4">-&gt;</span><span> HomePage </span><span style="color: #A626A4">{|</span><span> </span><span style="color: #A626A4">..</span><span> </span><span style="color: #A626A4">|}</span>
<span>    </span><span style="color: #A0A1A7;font-style: italic">// The code for About.fs will not be downloaded until</span>
<span>    </span><span style="color: #A0A1A7;font-style: italic">// the user selects the &quot;About&quot; page</span>
<span>    </span><span style="color: #A626A4">|</span><span> About </span><span style="color: #A626A4">-&gt;</span><span> AboutPage </span><span style="color: #A626A4">{|</span><span> </span><span style="color: #A626A4">..</span><span> </span><span style="color: #A626A4">|}</span></code></pre>
<p>You need also to make sure your webpack config includes the following:</p>
<pre style="background-color: #FFFFFF;color: #000000;padding: 1em"><code><span>    optimization: </span><span style="color: #383A42">{</span>
<span>        splitChunks: </span><span style="color: #383A42">{</span>
<span>            chunks: </span><span style="color: #50A14F">&quot;all&quot;</span>
<span>        </span><span style="color: #383A42">},</span>
<span>    </span><span style="color: #383A42">},</span></code></pre>
<p>As you've seen, you need to pass a <strong>direct reference to the external function</strong> as first argument to <code>FunctionComponent.Lazy</code> (avoid indirections like pipes, etc) so Fable can detect the path to the external file. Also, <strong>avoid other static references to the external file</strong> as this will pull the external code into the main bundle ruining the effect of code splitting. In Elmish apps, you'll usually have to add a reference to the <code>update</code> function of the external component. This makes it difficult to completely defer the download of code for the whole component (the state logic will get bundled in the main chunk), but if you separate the code for the component's state and view into different files, as it's common practice in Elmish apps, you can still defer the download of external resources needed for the view like CSS, JS libraries, etc. Have a look at <a href="https://github.com/MangelMaxime/fulma-demo/pull/27">this PR for a real-world example</a>.</p>
<p>Another trick to avoid static references is to use an <strong>anonymous record for the props of the external view function</strong>, so Fable doesn't need to refer to the constructor of a declared record when passing the props.</p>
<hr>
<p>Those are the most important new features in Fable.React 5 and I hope they help make your development experience with Fable and Elmish much more enjoyable. Looking forward to seeing the awesome projects you'll build with this!</p>
</div></div></div></div></div><script async="" src="/resources/nacara-standard-layouts/scripts/menu.js"></script></body></html>